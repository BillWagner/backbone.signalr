<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Backbone.signalr by SrtSolutions</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/SrtSolutions/backbone.signalr">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/SrtSolutions/backbone.signalr/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/SrtSolutions/backbone.signalr/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Backbone.signalr</h1>
          <p>Backbone.sync layer for SignalR</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/SrtSolutions">SrtSolutions</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h1>backbone.signalr</h1>

<p>Welcome to Backbone.SignalR, the sync layer for BackboneJS that lets you talk to a SignalR Server Hub.</p>

<p><a href="http://backbonejs.org/">Backbone.js </a> has a powerful model abstraction that allows you to synchronize your data with any data source (via Backbone.sync).  By default, Backbone models "sync" with REST services, but the Backbone.sync layer is replacable.  Backbone.signalr allows your models to "sync" with a real-time <a href="http://signalr.net/">SignalR</a> hub very easily.  In addition, all models on all clients will get updated in real-time!</p>

<p>Backbone.SignalR works with SignalR 1.0.  Looking for SignalR 0.5 support?  We've tagged it for you: (<a href="https://github.com/SrtSolutions/backbone.signalr/tags" title="Backbone.SignalR 0.5.0">https://github.com/SrtSolutions/backbone.signalr/tags</a>)</p>

<h1>Getting Started</h1>

<p>There are two simple ways to use Backbone.SignalR:</p>

<h2>Installing the Nuget Package</h2>

<p>You can search for it with the name Backbone.SignalR (and include pre-release packages) or you can install it directly via the <a href="http://docs.nuget.org/docs/start-here/using-the-package-manager-console">Package Manager Console</a>:</p>

<p><code>PM&gt; Install-Package Backbone.SignalR -Pre</code></p>

<p>This will bring in the dependencies of SignalR and Backbone.js if you don't already have it.  It will put <code>backbone.signalr.js</code> in your <strong>Scripts</strong> folder and it will put <code>BackboneModelHub.cs</code> into your <strong>Hubs</strong> folder</p>

<h2>Include the files manually</h2>

<p>If you don't want to use the Nuget package, you can simply include the <strong>client/backbone.signalr.js</strong> file in your project and then copy <strong>server/BackboneModelHub.cs</strong> somewhere in your project and that is all you need.</p>

<h1>Using the Backbone Model Hub</h1>

<p>You need to create a Model Hub in order to synchronize with the Backbone Frontend.  The base class handles the communication and updates, but you have control over how the data is managed.  Let's say, for instance, that you have a model called <strong>Person</strong>:</p>

<div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">First</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Last</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">PersonDBContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">Person</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You can create a <strong>PersonHub</strong> which stores models in a collection for demonstration.  Override the actions that you want to support:</p>

<div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">PersonHub</span> <span class="p">:</span> <span class="n">BackboneModelHub</span><span class="p">&lt;</span><span class="n">PersonHub</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">PersonDBContext</span> <span class="n">_db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PersonDBContext</span><span class="p">();</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">Person</span> <span class="nf">CreateModel</span><span class="p">(</span><span class="n">Person</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">model</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">FindModels</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">AsEnumerable</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, the actual mechanism to store and retrieve your data is up to you.  You might be talking to a service layer or annother ORM.  This Entity Framework example is just to get you started.</p>

<p><strong>Important:</strong> The <strong>PersonHub</strong> is responsible for creating a unique identifier of some sort.  This might happen in your ORM, or you might add it here.  It is all up to you.</p>

<p>More overrides on the <strong>BackboneModelHub</strong> include:</p>

<ul>
<li>UpdateModel</li>
<li>FindModel</li>
<li>DeleteModel</li>
</ul><div class="highlight"><pre>    <span class="k">protected</span> <span class="k">override</span> <span class="n">Person</span> <span class="nf">FindModel</span><span class="p">(</span><span class="n">Person</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">ID</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">Person</span> <span class="nf">UpdateModel</span><span class="p">(</span><span class="n">Person</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">model</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">model</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="n">Person</span> <span class="nf">DeleteModel</span><span class="p">(</span><span class="n">Person</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Person</span> <span class="n">person</span> <span class="p">=</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">ID</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">person</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">person</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>

<p>SignalR requires you to register the hubs via inspection.  In <strong>Global.asax.cs</strong>, add this line as the first inside of <strong>Application_Start()</strong>.  </p>

<div class="highlight"><pre><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">MapHubs</span><span class="p">();</span>
</pre></div>

<h1>Using the Client-Side Sync Layer</h1>

<p>You will need to include SignalR (version to change as it progresses), the Hubs, and <strong>Backbone.signalr.js</strong></p>

<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/Scripts/jquery.signalR-1.0.0-rc2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"signalr/hubs"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"~/Scripts/backbone.signalr.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>Then, you can tell your collection to synchronize with the backend:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>
<span class="kd">var</span> <span class="nx">People</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">model</span><span class="o">:</span> <span class="nx">Person</span><span class="p">,</span>
    <span class="nx">signalRHub</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">SignalR</span><span class="p">(</span><span class="s2">"personHub"</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>

<p>Now, after you start your SignalR connection, you can fetch, create, update and destroy data via SignalR:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">People</span><span class="p">();</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">hub</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">people</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If you want it to listen to real-time changes that are pushed from the server, simply tell it to do so.  All clients who are listening will get model updates automatically:</p>

<div class="highlight"><pre><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">signalRHub</span><span class="p">.</span><span class="nx">syncUpdates</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h1>Optional: Hybrid approach</h1>

<p>If you already have existing controller that you want to use and you don't want to duplicate your efforts in the hub, it is pretty easy.  This is a hybrid approach and allows you to maintain a standard REST api for traditional communication but allows your clients to synchronize changes when they happen.</p>

<p>In this case, you can create your hub without any persistence details:</p>

<div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">PersonHub</span> <span class="p">:</span> <span class="n">BackboneModelHub</span><span class="p">&lt;</span><span class="n">PersonHub</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>

<p>The hub exposes several static methods that can be called from anywhere:</p>

<ul>
<li>BroadcastModelCreated </li>
<li>BroadcastModelUpdated</li>
<li>BroadcastModelDestroyed</li>
<li>BroadcastCollectionReset</li>
</ul><p>The last one (BroadcastCollectionReset) is used when your entire back-end collection has changed enough so that you want to tell all of the clients that they need to reset.  The synchronization on the client will call Collection.reset with the collection you send it.</p>

<p>So, imagine you have a WebAPI controller that manages people.  You just need to call the Hub's static methods:</p>

<div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">PersonController</span> <span class="p">:</span> <span class="n">ApiController</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">PersonDBContext</span> <span class="n">_db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PersonDBContext</span><span class="p">();</span>

    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">GetPeople</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">AsEnumerable</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Person</span> <span class="nf">GetPerson</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Person</span> <span class="nf">PutPerson</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Person</span> <span class="n">person</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">person</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

        <span class="n">PersonHub</span><span class="p">.</span><span class="n">BroadcastModelUpdated</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">person</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Person</span> <span class="nf">PostPerson</span><span class="p">(</span><span class="n">Person</span> <span class="n">person</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

        <span class="n">PersonHub</span><span class="p">.</span><span class="n">BroadcastModelCreated</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">person</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Person</span> <span class="nf">DeletePerson</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Person</span> <span class="n">person</span> <span class="p">=</span> <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">person</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">_db</span><span class="p">.</span><span class="n">Person</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

        <span class="n">PersonHub</span><span class="p">.</span><span class="n">BroadcastModelDestroyed</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">person</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">(</span><span class="kt">bool</span> <span class="n">disposing</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_db</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
        <span class="k">base</span><span class="p">.</span><span class="n">Dispose</span><span class="p">(</span><span class="n">disposing</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The Client-side javascript collection would synchronize with the REST service like it normally would:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>
<span class="kd">var</span> <span class="nx">People</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">model</span><span class="o">:</span> <span class="nx">Person</span><span class="p">,</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">"/api/person"</span>
<span class="p">});</span>
</pre></div>

<p>But when you create your collection, you sync updates that come from SignalR:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">People</span><span class="p">();</span>
<span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">SignalR</span><span class="p">(</span><span class="s2">"personHub"</span><span class="p">).</span><span class="nx">syncUpdates</span><span class="p">(</span><span class="nx">people</span><span class="p">);</span>
<span class="nx">people</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">hub</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</pre></div>

<h1>Contributions</h1>

<p>If you can think of any way to make this integration better, please let me know.  I will consider all pull requests as wel as recommendations.  </p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>